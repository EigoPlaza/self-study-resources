<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>ç¬é–“è‹±ä½œæ–‡ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 1rem; display:flex; flex-direction:column; align-items:center; }
    .controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
      max-width: 700px;
    }

    /* å„æ®µ */
    .row {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    
    .row1 > div {
      display: flex;
      flex-direction: column;
      min-width: 140px;
      flex: 1;
    }
    
    .row2 {
      align-items: flex-end;
    }
    
    .structure-input {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .structure-button {
      flex-shrink: 0;
    }
    
    .row3 {
      justify-content: flex-start;
    }
    
    .row3 button {
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      background-color: #007bff;
      color: white;
    }
    
    .row3 button:hover {
      background-color: #0056b3;
    }
    
    .controls select, .controls input, .controls button {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .controls button {
      background-color: #f0f0f0;
      border: 1px solid #999;
    }
    .controls label {
      font-weight: bold;
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
      display: block;
    }
    
    .controls button:hover {
      background-color: #e0e0e0;
    }

    #generateBtn {
      background-color: #007bff;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      padding: 0.6rem 1.2rem;
      margin-bottom: 1rem; /* ä¸Šã®ä½™ç™½ã‚’ã“ã“ã«ã‚‚è¿½åŠ  */
      box-shadow: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å½±ã‚’ãªãã™ã¨ç©ã‚„ã‹ã« */
    }
    
    #generateBtn:hover {
      background-color: #0056b3;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }

    .structure-row {
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      gap: 0.5rem;
      width: 100%;
      max-width: 600px;
      margin-bottom: 1rem;
    }
    
    .structure-input {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .structure-button {
      flex-shrink: 0;
    }
    
    /* Collapsible structure list */
    #structureList {
      display: none;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      background: #f9f9f9;
      border: 1px solid #ccc;
      padding: 0.5rem;
      border-radius: 6px;
    }
    #structureList ul { list-style:none; margin:0; padding:0; }
    #structureList li { padding:0.25rem 0; cursor:pointer; }
    #structureList li:hover { background:#f0f0f0; }

    /* Flashcard styles */
    #flashcardContainer { perspective: 1000px; width: 90%; max-width: 400px; height: 250px; margin-bottom:1rem; }
    .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; cursor:pointer; }
    .flipped { transform: rotateY(180deg); }
    .card-face { position: absolute; width:100%; height:100%; backface-visibility:hidden; display:flex; align-items:center; justify-content:center; border:1px solid #333; border-radius:12px; padding:1rem; text-align:center; font-size:1.25rem; }
    .card-front { background:#fff; }
    .card-back { background:#fafafa; transform: rotateY(180deg); }

    .nav { display:flex; gap:1rem; align-items:center; }
    .nav button { padding:0.5rem 1rem; font-size:1rem; cursor:pointer; }
  </style>
</head>
<body>
  <div class="controls">
    <div class="row row1">
      <!-- èªå½™ãƒ¬ãƒ™ãƒ« -->
      <div>
        <label for="levelSelect">ğŸ”¤ èªå½™ãƒ¬ãƒ™ãƒ«</label>
          <select id="levelSelect">
            <option value="åˆç´š">åˆç´šï¼ˆä¸­å­¦è‹±èªï¼‰</option>
            <option value="ä¸­ç´š">ä¸­ç´šï¼ˆé«˜æ ¡è‹±èªï¼‰</option>
            <option value="ä¸Šç´š">ä¸Šç´šï¼ˆæŠ½è±¡è¡¨ç¾å«ã‚€ï¼‰</option>
          </select>
      </div>
  
      <!-- æ–‡æ³•é …ç›® -->
      <div>
        <label for="grammarSelect">ğŸ§  æ–‡æ³•é …ç›®</label>
        <select id="grammarSelect">
          <option value="">-- æ–‡æ³•é …ç›®ï¼ˆä»»æ„ï¼‰ --</option>
          
          <optgroup label="ä¸­1">
            <option value="beå‹•è©">beå‹•è©</option>
            <option value="ä¸€èˆ¬å‹•è©">ä¸€èˆ¬å‹•è©</option>
            <option value="å‘½ä»¤æ–‡">å‘½ä»¤æ–‡</option>
            <option value="Let's">Let's</option>
            <option value="ç–‘å•è©ï¼ˆwhat, who, where, when, etcï¼‰">ç–‘å•è©ï¼ˆwhat, who, where, when, etcï¼‰</option>
            <option value="ä»£åè©ï¼ˆä¸»æ ¼ãƒ»æ‰€æœ‰æ ¼ãƒ»ç›®çš„æ ¼ï¼‰">ä»£åè©ï¼ˆä¸»æ ¼ãƒ»æ‰€æœ‰æ ¼ãƒ»ç›®çš„æ ¼ï¼‰</option>
            <option value="ä¸‰äººç§°å˜æ•°ç¾åœ¨">ä¸‰äººç§°å˜æ•°ç¾åœ¨</option>
            <option value="canï¼ˆå¯èƒ½ï¼‰">canï¼ˆå¯èƒ½ï¼‰</option>
            <option value="ç¾åœ¨é€²è¡Œå½¢">ç¾åœ¨é€²è¡Œå½¢</option>
            <option value="there is / there are">there is / there are</option>
          </optgroup>
        
          <optgroup label="ä¸­2">
            <option value="éå»å½¢">éå»å½¢</option>
            <option value="éå»é€²è¡Œå½¢">éå»é€²è¡Œå½¢</option>
            <option value="æœªæ¥è¡¨ç¾ï¼ˆwill / be going toï¼‰">æœªæ¥è¡¨ç¾ï¼ˆwill / be going toï¼‰</option>
            <option value="åŠ©å‹•è©ï¼ˆmust, have to, should, etcï¼‰">åŠ©å‹•è©ï¼ˆmust, have to, should, etcï¼‰</option>
            <option value="ä¸å®šè©ï¼ˆåè©çš„ãƒ»å½¢å®¹è©çš„ãƒ»å‰¯è©çš„ç”¨æ³•ï¼‰">ä¸å®šè©ï¼ˆåè©çš„ãƒ»å½¢å®¹è©çš„ãƒ»å‰¯è©çš„ç”¨æ³•ï¼‰</option>
            <option value="å‹•åè©">å‹•åè©</option>
            <option value="æ¯”è¼ƒï¼ˆåŸç´šãƒ»æ¯”è¼ƒç´šãƒ»æœ€ä¸Šç´šï¼‰">æ¯”è¼ƒï¼ˆåŸç´šãƒ»æ¯”è¼ƒç´šãƒ»æœ€ä¸Šç´šï¼‰</option>
            <option value="so ... that / too ... to">so ... that / too ... to</option>
            <option value="æ¥ç¶šè©ï¼ˆwhen, if, because, etcï¼‰">æ¥ç¶šè©ï¼ˆwhen, if, because, etcï¼‰</option>
          </optgroup>
        
          <optgroup label="ä¸­3">
            <option value="å—å‹•æ…‹">å—å‹•æ…‹</option>
            <option value="ç¾åœ¨å®Œäº†ï¼ˆçµŒé¨“ãƒ»å®Œäº†ãƒ»ç¶™ç¶šï¼‰">ç¾åœ¨å®Œäº†ï¼ˆçµŒé¨“ãƒ»å®Œäº†ãƒ»ç¶™ç¶šï¼‰</option>
            <option value="é–¢ä¿‚ä»£åè©ï¼ˆä¸»æ ¼ãƒ»ç›®çš„æ ¼ï¼‰">é–¢ä¿‚ä»£åè©ï¼ˆä¸»æ ¼ãƒ»ç›®çš„æ ¼ï¼‰</option>
            <option value="é–¢ä¿‚å‰¯è©ï¼ˆwhen / whereï¼‰">é–¢ä¿‚å‰¯è©ï¼ˆwhen / whereï¼‰</option>
            <option value="åè©ç¯€ï¼ˆthat / if / whetherï¼‰">åè©ç¯€ï¼ˆthat / if / whetherï¼‰</option>
            <option value="åˆ†è©ï¼ˆç¾åœ¨åˆ†è©ãƒ»éå»åˆ†è©ï¼‰">åˆ†è©ï¼ˆç¾åœ¨åˆ†è©ãƒ»éå»åˆ†è©ï¼‰</option>
            <option value="SVOOãƒ»SVOCæ§‹æ–‡">SVOOãƒ»SVOCæ§‹æ–‡</option>
          </optgroup>
        
          <optgroup label="é«˜æ ¡ä»¥ä¸Š">
            <option value="ä»®å®šæ³•ï¼ˆç¾åœ¨ãƒ»éå»ï¼‰">ä»®å®šæ³•ï¼ˆç¾åœ¨ãƒ»éå»ï¼‰</option>
            <option value="wishæ§‹æ–‡">wishæ§‹æ–‡</option>
            <option value="åŸå½¢ä¸å®šè©ï¼ˆmake / let / haveï¼‰">åŸå½¢ä¸å®šè©ï¼ˆmake / let / haveï¼‰</option>
            <option value="å½¢å¼ä¸»èª / å½¢å¼ç›®çš„èª">å½¢å¼ä¸»èª / å½¢å¼ç›®çš„èª</option>
            <option value="ç„¡ç”Ÿç‰©ä¸»èªæ§‹æ–‡">ç„¡ç”Ÿç‰©ä¸»èªæ§‹æ–‡</option>
            <option value="åˆ†è©æ§‹æ–‡">åˆ†è©æ§‹æ–‡</option>
            <option value="å¼·èª¿æ§‹æ–‡ï¼ˆIt is ã€œ that ã€œï¼‰">å¼·èª¿æ§‹æ–‡ï¼ˆIt is ã€œ that ã€œï¼‰</option>
            <option value="å€’ç½® / æŒ¿å…¥">å€’ç½® / æŒ¿å…¥</option>
          </optgroup>
        </select>
      </div>
  
      <!-- ãƒˆãƒ”ãƒƒã‚¯ -->
      <div>
        <label for="topicSelect">ğŸ—‚ï¸ ãƒˆãƒ”ãƒƒã‚¯</label>
          <select id="topicSelect">
            <option value="">-- ãƒˆãƒ”ãƒƒã‚¯ï¼ˆä»»æ„ï¼‰ --</option>
            <option value="æ—¥å¸¸ç”Ÿæ´»">æ—¥å¸¸ç”Ÿæ´»</option>
            <option value="è²·ã„ç‰©">è²·ã„ç‰©</option>
            <option value="æ—…è¡Œ">æ—…è¡Œ</option>
            <option value="å­¦æ ¡">å­¦æ ¡</option>
            <option value="ä»•äº‹">ä»•äº‹</option>
            <option value="å¥åº·ãƒ»ç—…é™¢">å¥åº·ãƒ»ç—…é™¢</option>
            <option value="å®¶æ—ãƒ»å‹äºº">å®¶æ—ãƒ»å‹äºº</option>
            <option value="è¶£å‘³ãƒ»å¨¯æ¥½">è¶£å‘³ãƒ»å¨¯æ¥½</option>
            <option value="é£Ÿã¹ç‰©ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³">é£Ÿã¹ç‰©ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</option>
            <option value="æ„Ÿæƒ…ãƒ»æ°—æŒã¡">æ„Ÿæƒ…ãƒ»æ°—æŒã¡</option>
            <option value="å¤©æ°—ãƒ»è‡ªç„¶">å¤©æ°—ãƒ»è‡ªç„¶</option>
            <option value="å°†æ¥ãƒ»å¤¢">å°†æ¥ãƒ»å¤¢</option>
            <option value="æ•™è‚²">æ•™è‚²</option>
            <option value="æ”¿æ²»ãƒ»çµŒæ¸ˆ">æ”¿æ²»ãƒ»çµŒæ¸ˆ</option>
            <option value="ç’°å¢ƒå•é¡Œ">ç’°å¢ƒå•é¡Œ</option>
            <option value="è¨€èªå­¦ç¿’">è¨€èªå­¦ç¿’</option>
          </select>
      </div>
    </div>
    
    <div class="row row2">
      <div class="structure-input">
        <label for="structureInput">âœï¸ ç‰¹å®šæ§‹æ–‡ï¼ˆä»»æ„ï¼‰</label>
        <input id="structureInput" placeholder="æ§‹æ–‡ (ä»»æ„)" />
      </div>
      <div class="structure-button">
        <button id="toggleListBtn">âœï¸ ä½¿ã„ã“ãªã—ãŸã„æ§‹æ–‡ãƒªã‚¹ãƒˆ</button>
      </div>
    </div>
    <div id="structureList">
      <strong>âœï¸ ä½¿ã„ã“ãªã—ãŸã„æ§‹æ–‡ãƒªã‚¹ãƒˆ</strong>
      <ul>
        <li data-structure="be supposed to">be supposed to</li>
        <li data-structure="have something done">have something done</li>
        <li data-structure="used to / be used to">used to / be used to</li>
        <li data-structure="not only A but also B">not only A but also B</li>
        <li data-structure="It takes äºº æ™‚é–“ to ~">It takes äºº æ™‚é–“ to ~</li>
        <li data-structure="The æ¯”è¼ƒç´š, the æ¯”è¼ƒç´š">The æ¯”è¼ƒç´š, the æ¯”è¼ƒç´š</li>
        <li data-structure="as soon as ~">as soon as ~</li>
        <li data-structure="in order to ~">in order to ~</li>
        <li data-structure="no matter ç–‘å•è©">no matter ç–‘å•è©</li>
        
        <li data-structure="é–¢ä¿‚ä»£åè©ã®çœç•¥">é–¢ä¿‚ä»£åè©ã®çœç•¥</li>
      </ul>
    </div>
    <div class="row row3">
      <button id="generateBtn">ç¬é–“è‹±ä½œæ–‡ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    </div>
    <div id="loadingMessage" style="text-align:center; font-weight:bold; color:#007bff; margin-bottom:1rem; display:none;">
      ğŸ”„ ç”Ÿæˆä¸­ã§ã™... å°‘ã€…ãŠå¾…ã¡ãã ã•ã„
    </div>
  </div>



  <div id="flashcardContainer">
    <div id="cardInner" class="card-inner">
      <div class="card-face card-front" id="cardFront">ã“ã“ã«æ—¥æœ¬èªæ–‡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
      <div class="card-face card-back" id="cardBack">English sentence appears here</div>
    </div>
  </div>
  <div class="nav">
    <button id="prevBtn">Prev</button>
    <span id="cardCounter">0 / 0</span>
    <button id="nextBtn">Next</button>
  </div>
  <div style="margin-top: 1.5rem;">
    <button id="downloadCsvBtn">ğŸ“¥ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    <button id="downloadPdfBtn">ğŸ“„ PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  </div>

  <script src="https://unpkg.com/pdf-lib@1.4.0/dist/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/@pdf-lib/fontkit/dist/fontkit.umd.js"></script>


  <script>
    document.getElementById('downloadPdfBtn').addEventListener('click', async () => {
      if (!currentFlashcards || currentFlashcards.length === 0) {
        alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
      }
  
      const { PDFDocument, rgb } = PDFLib;
      const pdfDoc = await PDFDocument.create();
      pdfDoc.registerFontkit(fontkit);
  
      const fontUrl = './ipaexg.ttf';
      const fontBytes = await fetch(fontUrl).then(res => res.arrayBuffer());
      const customFont = await pdfDoc.embedFont(fontBytes, { subset: true });
  
      let page = pdfDoc.addPage([595, 842]); // A4ã‚µã‚¤ã‚º
      const { width, height } = page.getSize();
  
      const leftX = 50;
      const rightX = 300;
      const maxTextWidth = 230; // æ—¥æœ¬èªã®æœ€å¤§å¹…
      const fontSize = 12;
      const lineHeight = 20;
      let y = height - 50;
  
      page.setFont(customFont);
      page.setFontSize(14);
      page.drawText('ç¬é–“è‹±ä½œæ–‡ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ä¸€è¦§', { x: leftX, y });
      y -= 30;
  
      for (let i = 0; i < currentFlashcards.length; i++) {
        const { jp, en } = currentFlashcards[i];
        
        const jpLines = splitText(jp, customFont, fontSize, maxTextWidth);
        // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã«ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è¿½åŠ 
        page.drawText('Â© Eplaï¼ˆã‚¨ãƒ—ãƒ©ï¼‰ https://eigoplaza.com', {
          x: 50,
          y: 30,
          size: 10,
          font: customFont,
          color: rgb(0.5, 0.5, 0.5),
        });
        if (y < 60 + jpLines.length * lineHeight) {
          page = pdfDoc.addPage([595, 842]);
          page.setFont(customFont);
          page.setFontSize(fontSize);
          y = height - 50;
        }
  
        for (let j = 0; j < jpLines.length; j++) {
          page.drawText(j === 0 ? `${i + 1}. ${jpLines[j]}` : `    ${jpLines[j]}`, {
            x: leftX,
            y: y - j * lineHeight,
            size: fontSize,
            font: customFont,
            color: rgb(0, 0, 0),
          });
        }
  
        page.drawText(en, {
          x: rightX,
          y,
          size: fontSize,
          font: customFont,
          color: rgb(0, 0, 0),
        });
  
        y -= Math.max(jpLines.length, 1) * lineHeight + 10;
      }
      // æœ€å¾Œã®ãƒšãƒ¼ã‚¸ã«ã‚‚ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è¿½åŠ 
      page.drawText('Â© Eplaï¼ˆã‚¨ãƒ—ãƒ©ï¼‰ https://eigoplaza.com', {
        x: 50,
        y: 30,
        size: 10,
        font: customFont,
        color: rgb(0.5, 0.5, 0.5),
      });
      
      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'flashcards.pdf';
      link.click();
    });
  
    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼šæ—¥æœ¬èªã‚’æŠ˜ã‚Šè¿”ã™
    function splitText(text, font, size, maxWidth) {
      const chars = text.split('');
      let line = '';
      const lines = [];
  
      for (let i = 0; i < chars.length; i++) {
        const nextLine = line + chars[i];
        const width = font.widthOfTextAtSize(nextLine, size);
        if (width > maxWidth) {
          lines.push(line);
          line = chars[i];
        } else {
          line = nextLine;
        }
      }
  
      if (line) lines.push(line);
      return lines;
    }
  </script>
    
  <script>
    // Dummy data (initial)
    const dummyCards = [
      { jp: 'ç§ã¯æ˜¨æ—¥å®¿é¡Œã‚’ã—ãŸã€‚', en: 'I did my homework yesterday.' },
      { jp: 'å½¼ã¯ä»Šã‚µãƒƒã‚«ãƒ¼ã‚’ã—ã¦ã„ã‚‹ã€‚', en: 'He is playing soccer now.' },
      { jp: 'ã‚ãªãŸã¯çŒ«ãŒå¥½ãã§ã™ã‹ï¼Ÿ', en: 'Do you like cats?' },
      { jp: 'ç§ã¯æ±äº¬ã«è¡Œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚', en: 'I have been to Tokyo.' },
      { jp: 'æ˜æ—¥é›¨ãŒé™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚', en: 'It may rain tomorrow.' },
      { jp: 'ç§ã¯éŸ³æ¥½ã‚’è´ãã®ãŒå¥½ãã§ã™ã€‚', en: 'I like listening to music.' },
      { jp: 'è‹±èªã‚’è©±ã™ã“ã¨ã¯æ¥½ã—ã„ã€‚', en: 'Speaking English is fun.' },
      { jp: 'å½¼å¥³ã¯æ˜¨æ—¥ãƒ†ãƒ¬ãƒ“ã‚’è¦‹ãªã‹ã£ãŸã€‚', en: 'She didn\'t watch TV yesterday.' }
    ];

    let cards = [];
    let currentFlashcards = [];
    let current = 0;

    const cardInner = document.getElementById('cardInner');
    const cardFront = document.getElementById('cardFront');
    const cardBack = document.getElementById('cardBack');
    const cardCounter = document.getElementById('cardCounter');

    function renderCard() {
      if (cards.length === 0) {
        cardFront.textContent = "ğŸ‘‰ æ¡ä»¶ã‚’é¸ã‚“ã§ã€ç¬é–“è‹±ä½œæ–‡ã‚¹ã‚¿ãƒ¼ãƒˆï¼ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„";
        cardBack.textContent = "English sentence will appear here";
        cardCounter.textContent = "0 / 0";
        cardInner.classList.remove('flipped');
        return;
      }
    
      cardFront.textContent = cards[current].jp;
      cardBack.textContent = cards[current].en;
      cardCounter.textContent = `${current + 1} / ${cards.length}`;
      cardInner.classList.remove('flipped');
    }

    // Navigation
    document.getElementById('nextBtn').addEventListener('click', () => {
      if (current < cards.length - 1) current++; else current = 0;
      renderCard();
    });
    document.getElementById('prevBtn').addEventListener('click', () => {
      if (current > 0) current--; else current = cards.length - 1;
      renderCard();
    });

    // Flip on click/tap
    cardInner.addEventListener('click', () => {
      cardInner.classList.toggle('flipped');
    });

    // Swipe support
    let startX = null;
    cardInner.addEventListener('touchstart', e => {
      startX = e.touches[0].clientX;
    });
    cardInner.addEventListener('touchend', e => {
      if (startX === null) return;
      let endX = e.changedTouches[0].clientX;
      let diff = startX - endX;
      if (Math.abs(diff) > 30) {
        if (diff > 0) { // swipe left
          document.getElementById('nextBtn').click();
        } else {
          document.getElementById('prevBtn').click();
        }
      }
      startX = null;
    });

    // Toggle structure list
    document.getElementById('toggleListBtn').addEventListener('click', () => {
      const list = document.getElementById('structureList');
      list.style.display = list.style.display === 'none' || list.style.display === '' ? 'block' : 'none';
    });

    // Click on structure to fill input
    document.querySelectorAll('#structureList li').forEach(li => {
      li.addEventListener('click', () => {
        document.getElementById('structureInput').value = li.dataset.structure;
        document.getElementById('structureList').style.display = 'none';
      });
    });

    const topic = document.getElementById("topicSelect").value;
    // é€ä¿¡æ™‚ã« topic ãŒç©ºã§ã‚‚ OK ã«ã—ã¦ãŠãï¼ˆç©ºãªã‚‰ç„¡è¦– or å…¨ä½“ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
    const grammar = document.getElementById("grammarSelect").value;
    // grammarãŒç©ºãªã‚‰AIå´ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã€Œç‰¹å®šã—ãªã„ï¼ˆè‡ªç”±ï¼‰ã€ã¨ã¿ãªã™ã‚ˆã†å‡¦ç†
    
    
    // Generate button (currently loads dummy cards)
    document.getElementById('generateBtn').addEventListener('click', async () => {
      const level = document.getElementById("levelSelect").value;
      const grammar = document.getElementById("grammarSelect").value;
      const topic = document.getElementById("topicSelect").value;
      const structure = document.getElementById("structureInput").value;

      const loadingMsg = document.getElementById("loadingMessage");
      loadingMsg.style.display = "block"; // â† è¡¨ç¤ºé–‹å§‹
      
      try {
        const res = await fetch('https://shunkan-ai.eigoplaza.workers.dev', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ level, grammar, topic, structure }),
        });
    
        if (res.ok) {
          cards = await res.json();
          currentFlashcards = cards; // â† ã“ã®è¡Œã‚’è¿½åŠ ï¼
          current = 0;
          renderCard();
        } else {
          alert("ã‚«ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
        }
      } catch (e) {
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š" + e.message);
      } finally {
        loadingMsg.style.display = "none"; // â† å®Œäº†å¾Œã«éè¡¨ç¤º
      }
    });
    // Initial render
    renderCard();

    document.getElementById('downloadCsvBtn').addEventListener('click', () => {
    if (!currentFlashcards || currentFlashcards.length === 0) {
      alert('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }
  
    const csvHeader = `"æ—¥æœ¬èª","è‹±èª"\n`;
    const csvRows = currentFlashcards.map(pair =>
      `"${pair.jp.replace(/"/g, '""')}","${pair.en.replace(/"/g, '""')}"`
    ).join('\n');
  
    const blob = new Blob([csvHeader + csvRows], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'flashcards.csv';
    link.click();
  });
    
  </script>
</body>
</html>
