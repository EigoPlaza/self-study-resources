<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>éŸ³èª­ç”¨éŸ³å£°ä½œæˆAI</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 2em;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 600px;
      width: 100%;
      background: #fff;
      padding: 2em;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      border-radius: 10px;
    }
    textarea {
      width: 100%;
      height: 120px;
      font-size: 1em;
      padding: 1em;
      box-sizing: border-box;
      border-radius: 6px;
    }
    button {
      font-size: 1em;
      padding: 0.5em 1em;
      margin-top: 1em;
    }
    .output {
      margin-top: 2em;
      background: white;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    audio {
      width: 100%;
      max-width: 500px;
      margin-top: 0.5em;
    }
    a.download-btn {
      display: inline-block;
      margin-top: 0.5em;
      padding: 0.4em 1em;
      background-color: #e0e0e0;
      color: #333;
      text-decoration: none;
      border-radius: 4px;
      font-size: 0.9em;
    }
    a.download-btn:hover {
      background-color: #d0d0d0;
    }
    .error {
      color: red;
      font-size: 0.9em;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ—£ï¸ éŸ³èª­ç”¨éŸ³å£°ä½œæˆAIï¼ˆãƒ™ãƒ¼ã‚¿ï¼‰</h1>
    <p>ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ <code>/</code> ã§åŒºåˆ‡ã£ãŸè‹±æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

    <textarea id="inputText" placeholder="ä¾‹ï¼šHow are you? / I'm fine, thank you. / And you?"></textarea>
    <div style="text-align: right; font-size: 0.9em; color: #666;" id="wordCount">å˜èªæ•°ï¼š0 / 150</div>
    <div class="error" id="errorMessage"></div>
    <br />
    <label for="voice">ğŸ—£ï¸ éŸ³å£°ã®ç¨®é¡ï¼š</label>
    <select id="voice">
      <option value="en-US-Wavenet-B" selected>ç”·æ€§ï¼ˆè½ã¡ç€ããƒ»è¦ªã—ã¿ï¼‰</option>
      <option value="en-US-Wavenet-A">ç”·æ€§ï¼ˆè‹¥ã‚ãƒ»è‡ªç„¶ï¼‰</option>
      <option value="en-US-Wavenet-D">ç”·æ€§ï¼ˆã¯ã¤ã‚‰ã¤ãƒ»è‹¥ã‚ï¼‰</option>
      <option value="en-US-Wavenet-E">å¥³æ€§ï¼ˆçŸ¥çš„ãƒ»ã‚¯ãƒ¼ãƒ«ï¼‰</option>
      <option value="en-US-Wavenet-C">å¥³æ€§ï¼ˆè½ã¡ç€ããƒ»å¤§äººï¼‰</option>
      <option value="en-US-Wavenet-F">å¥³æ€§ï¼ˆæ˜ã‚‹ã„ãƒ»è‹¥ã‚ï¼‰</option>
      <option value="en-US-Wavenet-G">å¥³æ€§ï¼ˆã¯ãã¯ããƒ»æ˜ç­ï¼‰</option>
      <option value="en-US-Wavenet-H">å¥³æ€§ï¼ˆæ¸©ã‹ã¿ãƒ»è¦ªã—ã¿ï¼‰</option>
    </select>
    <br />
    <button onclick="generateAudio()">ğŸ™ éŸ³å£°ã‚’ç”Ÿæˆ</button>

    <div class="output">
      <h2>ğŸ” ãƒãƒ¼ã‚ºã‚ã‚Šï¼ˆãƒªãƒ”ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”¨ï¼‰</h2>
      <audio id="audioWithPause" controls></audio>
      <a id="downloadWithPause" href="#" class="download-btn" download="with_pause.mp3">â¬‡ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>

      <h2>ğŸš€ ãƒãƒ¼ã‚ºãªã—ï¼ˆã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ç”¨ï¼‰</h2>
      <audio id="audioWithoutPause" controls></audio>
      <a id="downloadWithoutPause" href="#" class="download-btn" download="without_pause.mp3">â¬‡ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
    </div>
  </div>

  <script>
    const textInput = document.getElementById("inputText");
    const wordCount = document.getElementById("wordCount");
    const errorMessage = document.getElementById("errorMessage");

    textInput.addEventListener("input", () => {
      const text = textInput.value;
      const words = text.replace(/\//g, " ").trim().split(/\s+/).filter(w => w.length > 0);
      wordCount.textContent = `å˜èªæ•°ï¼š${words.length} / 150`;
    });

    async function generateAudio() {
      const text = document.getElementById("inputText").value.trim();
      const voice = document.getElementById("voice").value;

      if (!text) {
        errorMessage.textContent = "ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      errorMessage.textContent = "éŸ³å£°ã‚’ç”Ÿæˆä¸­ã§ã™...";

      try {
        // ğŸ” ãƒãƒ¼ã‚ºã‚ã‚Š
        const res1 = await fetch("https://ondoku-ai.eigoplaza.workers.dev/generate"", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text: text, voice: voice, pause: true })
        });

        // ğŸš€ ãƒãƒ¼ã‚ºãªã—
        const res2 = await fetch("https://ondoku-ai.eigoplaza.workers.dev/generate"", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text: text.replace(/\s*\/\s*/g, ' '), voice: voice, pause: false })
        });

        if (!res1.ok || !res2.ok) {
          throw new Error("éŸ³å£°ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ");
        }

        const blob1 = await res1.blob();
        const blob2 = await res2.blob();

        const url1 = URL.createObjectURL(blob1);
        const url2 = URL.createObjectURL(blob2);

        document.getElementById("audioWithPause").src = url1;
        document.getElementById("downloadWithPause").href = url1;

        document.getElementById("audioWithoutPause").src = url2;
        document.getElementById("downloadWithoutPause").href = url2;

        errorMessage.textContent = "";
      } catch (err) {
        console.error(err);
        errorMessage.textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
      }
    }
  </script>
</body>
</html>
